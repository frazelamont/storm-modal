!function(t,e){"object"==typeof exports?module.exports=e():t.StormModal=e()}(this,function(){"use strict";function t(t,i){var o=[].slice.call(document.querySelectorAll(t));if(0===o.length)throw new Error("Modal cannot be initialised, no trigger elements found");return e=o.map(function(t){return Object.assign(Object.create(s),{node:t,settings:Object.assign({},n,i)}).init()})}var e=[],i={TRIGGER_EVENTS:["click","keydown"],TRIGGER_KEYCODES:[13,32]},n={onClassName:"active",modalSelector:"js-modal",styles:[{opacity:0,visibility:"hidden",position:"absolute",overflow:"hidden",width:0,height:0},{opacity:1,visibility:"visible",overflow:"auto",position:"fixed",width:"auto",height:"auto",top:0,left:0,bottom:0,right:0,zIndex:9}],callback:null},s={init:function(){if(this.isOpen=!1,this.togglers=this.node.getAttribute("data-modal-toggler")&&[].slice.call(document.querySelectorAll("."+this.node.getAttribute("data-modal-toggler"))),!this.togglers)throw new Error("Modal cannot be initialised, no modal toggler elements found");return this.togglers.forEach(function(t){i.TRIGGER_EVENTS.forEach(function(e){t.addEventListener(e,function(t){t.keyCode&&!~i.TRIGGER_KEYCODES.indexOf(t.keyCode)||this.change(this)}.bind(this),!1)}.bind(this))}.bind(this)),this.focusableChildren=this.getFocusableChildren(),this.setStyles(),this.node.setAttribute("aria-hidden",!0),this},getFocusableChildren:function(){var t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'];return[].slice.call(this.node.querySelectorAll(t.join(","))).filter(function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)})},trapTab:function(t){var e=this.focusableChildren.indexOf(document.activeElement);t.shiftKey&&0===e?(t.preventDefault(),this.focusableChildren[this.focusableChildren.length-1].focus()):t.shiftKey||e!==this.focusableChildren.length-1||(t.preventDefault(),this.focusableChildren[0].focus())},setStyles:function(){for(var t in this.settings.styles[Number(this.isOpen)])this.node.style[t]=this.settings.styles[Number(this.isOpen)][t]},keyListener:function(t){this.isOpen&&27===t.keyCode&&(t.preventDefault(),this.toggle()),this.isOpen&&9===t.keyCode&&this.trapTab(t)},open:function(){document.addEventListener("keydown",this.keyListener.bind(this)),this.lastFocused=document.activeElement,window.setTimeout(function(){this.focusableChildren[0].focus()}.bind(this),0),this.toggle()},close:function(){document.removeEventListener("keydown",this.keyListener.bind(this)),this.lastFocused.focus(),this.toggle()},toggle:function(){this.isOpen=!this.isOpen,this.setStyles(),this.node.setAttribute("aria-hidden",!this.isOpen),document.querySelector("main")&&document.querySelector("main").setAttribute("aria-hidden",this.isOpen)},change:function(){this.isOpen?this.close():this.open(),"function"==typeof this.settings.callback&&this.settings.callback.call(this)}};return{init:t}});