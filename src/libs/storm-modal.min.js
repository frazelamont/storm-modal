!function(e,t){"object"==typeof exports?module.exports=t():e.StormModal=t()}(this,function(){"use strict";function e(e,i){var o=[].slice.call(document.querySelectorAll(e));if(0===o.length)throw new Error("Modal cannot be initialised, no trigger elements found");return t=o.map(function(e){return Object.assign(Object.create(s),{node:e,settings:Object.assign({},n,i)}).init()})}var t=[],i={TRIGGER_EVENTS:["click","keydown"],TRIGGER_KEYCODES:[13,32]},n={onClassName:"active",mainSelector:"main",modalSelector:"js-modal",callback:null},s={init:function(){if(this.isOpen=!1,this.togglers=this.node.getAttribute("data-modal-toggler")&&[].slice.call(document.querySelectorAll("."+this.node.getAttribute("data-modal-toggler"))),!this.togglers)throw new Error("Modal cannot be initialised, no modal toggler elements found");return this.togglers.forEach(function(e){i.TRIGGER_EVENTS.forEach(function(t){e.addEventListener(t,function(e){e.keyCode&&!~i.TRIGGER_KEYCODES.indexOf(e.keyCode)||this.change(this)}.bind(this),!1)}.bind(this))}.bind(this)),this.focusableChildren=this.getFocusableChildren(),this.node.setAttribute("aria-hidden",!0),this},getFocusableChildren:function(){var e=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'];return[].slice.call(this.node.querySelectorAll(e.join(","))).filter(function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)})},trapTab:function(e){var t=this.focusableChildren.indexOf(document.activeElement);e.shiftKey&&0===t?(e.preventDefault(),this.focusableChildren[this.focusableChildren.length-1].focus()):e.shiftKey||t!==this.focusableChildren.length-1||(e.preventDefault(),this.focusableChildren[0].focus())},keyListener:function(e){this.isOpen&&27===e.keyCode&&(e.preventDefault(),this.toggle()),this.isOpen&&9===e.keyCode&&this.trapTab(e)},open:function(){document.addEventListener("keydown",this.keyListener.bind(this)),this.lastFocused=document.activeElement,window.setTimeout(function(){this.focusableChildren[0].focus()}.bind(this),0),this.toggle()},close:function(){document.removeEventListener("keydown",this.keyListener.bind(this)),this.lastFocused.focus(),this.toggle()},toggle:function(){this.isOpen=!this.isOpen,this.node.setAttribute("aria-hidden",!this.isOpen),this.node.classList.toggle(this.settings.onClassName),document.querySelector(this.settings.mainSelector)&&document.querySelector(this.settings.mainSelector).setAttribute("aria-hidden",this.isOpen)},change:function(){this.isOpen?this.close():this.open(),"function"==typeof this.settings.callback&&this.settings.callback.call(this)}};return{init:e}});