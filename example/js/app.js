(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _stormModal = require('./libs/storm-modal');

var _stormModal2 = _interopRequireDefault(_stormModal);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var onDOMContentLoadedTasks = [function () {
	var modal = _stormModal2.default.init('.js-modal');
	console.log(modal);
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
	onDOMContentLoadedTasks.forEach(function (fn) {
		return fn();
	});
});

},{"./libs/storm-modal":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * @name storm-modal: Accessible modal dialogue
 * @version 0.6.0: Thu, 05 Jan 2017 14:47:57 GMT
 * @author mjbp
 * @license MIT
 */
var CONSTANTS = {
	TRIGGER_EVENTS: ['click', 'keydown'],
	TRIGGER_KEYCODES: [13, 32]
},
    defaults = {
	onClassName: 'active',
	mainSelector: 'main',
	modalSelector: 'js-modal',
	callback: false
};

var StormModal = {
	init: function init() {
		this.isOpen = false;
		this.togglers = this.node.getAttribute('data-modal-toggler') && [].slice.call(document.querySelectorAll('.' + this.node.getAttribute('data-modal-toggler')));

		if (!this.togglers.length) {
			throw new Error('Modal cannot be initialised, no modal toggler elements found');
		}

		this.initTriggers();
		this.focusableChildren = this.getFocusableChildren();
		this.node.setAttribute('aria-hidden', true);
		return this;
	},
	initTriggers: function initTriggers() {
		var _this = this;

		this.togglers.forEach(function (toggler) {
			CONSTANTS.TRIGGER_EVENTS.forEach(function (ev) {
				toggler.addEventListener(ev, function (e) {
					if (!!e.keyCode && !~CONSTANTS.TRIGGER_KEYCODES.indexOf(e.keyCode)) return;
					e.preventDefault();
					_this.change(_this);
				});
			});
		});
	},
	getFocusableChildren: function getFocusableChildren() {
		var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex="-1"])'];

		return [].slice.call(this.node.querySelectorAll(focusableElements.join(',')));
	},
	trapTab: function trapTab(e) {
		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);
		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				e.preventDefault();
				this.focusableChildren[0].focus();
			}
		}
	},
	keyListener: function keyListener(e) {
		if (this.isOpen && e.keyCode === 27) {
			e.preventDefault();
			this.toggle();
		}
		if (this.isOpen && e.keyCode === 9) {
			this.trapTab(e);
		}
	},
	open: function open() {
		var _this2 = this;

		document.addEventListener('keydown', this.keyListener.bind(this));
		this.lastFocused = document.activeElement;
		window.setTimeout(function () {
			_this2.focusableChildren[0].focus();
		}, 0);
		this.toggle();
	},
	close: function close() {
		document.removeEventListener('keydown', this.keyListener.bind(this));
		this.lastFocused.focus();
		this.toggle();
	},
	toggle: function toggle() {
		this.isOpen = !this.isOpen;
		this.node.setAttribute('aria-hidden', !this.isOpen);
		this.node.classList.toggle(this.settings.onClassName);
		document.querySelector(this.settings.mainSelector) && document.querySelector(this.settings.mainSelector).setAttribute('aria-hidden', this.isOpen);
	},
	change: function change() {
		if (!this.isOpen) {
			this.open();
		} else {
			this.close();
		}
		typeof this.settings.callback === 'function' && this.settings.callback.call(this);
	}
};

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (els.length === 0) throw new Error('Modal cannot be initialised, no trigger elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(StormModal), {
			node: el,
			settings: Object.assign({}, defaults, opts)
		}).init();
	});
};

exports.default = { init: init };

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL3N0b3JtLW1vZGFsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7Ozs7O0FBRUEsSUFBTSwwQkFBMEIsQ0FBQyxZQUFNO0FBQ3RDLEtBQUksUUFBUSxxQkFBTSxJQUFOLENBQVcsV0FBWCxDQUFaO0FBQ0EsU0FBUSxHQUFSLENBQVksS0FBWjtBQUVBLENBSitCLENBQWhDOztBQU1BLElBQUcsc0JBQXNCLE1BQXpCLEVBQWlDLE9BQU8sZ0JBQVAsQ0FBd0Isa0JBQXhCLEVBQTRDLFlBQU07QUFBRSx5QkFBd0IsT0FBeEIsQ0FBZ0M7QUFBQSxTQUFNLElBQU47QUFBQSxFQUFoQztBQUE4QyxDQUFsRzs7Ozs7Ozs7QUNSakM7Ozs7OztBQU1BLElBQU0sWUFBWTtBQUNoQixpQkFBZ0IsQ0FBQyxPQUFELEVBQVUsU0FBVixDQURBO0FBRWhCLG1CQUFrQixDQUFDLEVBQUQsRUFBSyxFQUFMO0FBRkYsQ0FBbEI7QUFBQSxJQUlDLFdBQVc7QUFDVixjQUFhLFFBREg7QUFFVixlQUFjLE1BRko7QUFHVixnQkFBZSxVQUhMO0FBSVYsV0FBVTtBQUpBLENBSlo7O0FBV0EsSUFBTSxhQUFhO0FBQ2xCLEtBRGtCLGtCQUNYO0FBQ04sT0FBSyxNQUFMLEdBQWMsS0FBZDtBQUNBLE9BQUssUUFBTCxHQUFnQixLQUFLLElBQUwsQ0FBVSxZQUFWLENBQXVCLG9CQUF2QixLQUFnRCxHQUFHLEtBQUgsQ0FBUyxJQUFULENBQWMsU0FBUyxnQkFBVCxDQUEwQixNQUFNLEtBQUssSUFBTCxDQUFVLFlBQVYsQ0FBdUIsb0JBQXZCLENBQWhDLENBQWQsQ0FBaEU7O0FBRUEsTUFBRyxDQUFDLEtBQUssUUFBTCxDQUFjLE1BQWxCLEVBQTBCO0FBQ3pCLFNBQU0sSUFBSSxLQUFKLENBQVUsOERBQVYsQ0FBTjtBQUNBOztBQUVE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QUFFLFVBQUYsRSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgTW9kYWwgZnJvbSAnLi9saWJzL3N0b3JtLW1vZGFsJztcblxuY29uc3Qgb25ET01Db250ZW50TG9hZGVkVGFza3MgPSBbKCkgPT4ge1xuXHRsZXQgbW9kYWwgPSBNb2RhbC5pbml0KCcuanMtbW9kYWwnKTtcblx0Y29uc29sZS5sb2cobW9kYWwpO1xuXG59XTtcbiAgICBcbmlmKCdhZGRFdmVudExpc3RlbmVyJyBpbiB3aW5kb3cpIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4geyBvbkRPTUNvbnRlbnRMb2FkZWRUYXNrcy5mb3JFYWNoKGZuID0+IGZuKCkpOyB9KTtcbiIsIi8qKlxuICogQG5hbWUgc3Rvcm0tbW9kYWw6IEFjY2Vzc2libGUgbW9kYWwgZGlhbG9ndWVcbiAqIEB2ZXJzaW9uIDAuNi4wOiBUaHUsIDA1IEphbiAyMDE3IDE0OjQ3OjU3IEdNVFxuICogQGF1dGhvciBtamJwXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuY29uc3QgQ09OU1RBTlRTID0ge1xuXHRcdFRSSUdHRVJfRVZFTlRTOiBbJ2NsaWNrJywgJ2tleWRvd24nXSxcblx0XHRUUklHR0VSX0tFWUNPREVTOiBbMTMsIDMyXVxuXHR9LFxuXHRkZWZhdWx0cyA9IHtcblx0XHRvbkNsYXNzTmFtZTogJ2FjdGl2ZScsXG5cdFx0bWFpblNlbGVjdG9yOiAnbWFpbicsXG5cdFx0bW9kYWxTZWxlY3RvcjogJ2pzLW1vZGFsJyxcblx0XHRjYWxsYmFjazogZmFsc2Vcblx0fTtcblxuY29uc3QgU3Rvcm1Nb2RhbCA9IHtcblx0aW5pdCgpIHtcblx0XHR0aGlzLmlzT3BlbiA9IGZhbHNlO1xuXHRcdHRoaXMudG9nZ2xlcnMgPSB0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW1vZGFsLXRvZ2dsZXInKSAmJiBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1tb2RhbC10b2dnbGVyJykpKTtcbiAgICAgICAgICAgIFxuXHRcdGlmKCF0aGlzLnRvZ2dsZXJzLmxlbmd0aCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdNb2RhbCBjYW5ub3QgYmUgaW5pdGlhbGlzZWQsIG5vIG1vZGFsIHRvZ2dsZXIgZWxlbWVudHMgZm91bmQnKTtcblx0XHR9XG5cblx0XHR0aGlzLmluaXRUcmlnZ2VycygpO1xuXHRcdHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4gPSB0aGlzLmdldEZvY3VzYWJsZUNoaWxkcmVuKCk7XG5cdFx0dGhpcy5ub2RlLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCB0cnVlKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fSxcblx0aW5pdFRyaWdnZXJzKCl7XG5cdFx0dGhpcy50b2dnbGVycy5mb3JFYWNoKHRvZ2dsZXIgPT4ge1xuXHRcdFx0Q09OU1RBTlRTLlRSSUdHRVJfRVZFTlRTLmZvckVhY2goZXYgPT4ge1xuXHRcdFx0XHR0b2dnbGVyLmFkZEV2ZW50TGlzdGVuZXIoZXYsIGUgPT4ge1xuXHRcdFx0XHRcdGlmKCEhZS5rZXlDb2RlICYmICF+Q09OU1RBTlRTLlRSSUdHRVJfS0VZQ09ERVMuaW5kZXhPZihlLmtleUNvZGUpKSByZXR1cm47XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHRoaXMuY2hhbmdlKHRoaXMpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9LFxuXHRnZXRGb2N1c2FibGVDaGlsZHJlbigpIHtcblx0XHRjb25zdCBmb2N1c2FibGVFbGVtZW50cyA9IFsnYVtocmVmXScsICdhcmVhW2hyZWZdJywgJ2lucHV0Om5vdChbZGlzYWJsZWRdKScsICdzZWxlY3Q6bm90KFtkaXNhYmxlZF0pJywgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKScsICdidXR0b246bm90KFtkaXNhYmxlZF0pJywgJ2lmcmFtZScsICdvYmplY3QnLCAnZW1iZWQnLCAnW2NvbnRlbnRlZGl0YWJsZV0nLCAnW3RhYmluZGV4XTpub3QoW3RhYmluZGV4PVwiLTFcIl0pJ107XG5cblx0XHRyZXR1cm4gW10uc2xpY2UuY2FsbCh0aGlzLm5vZGUucXVlcnlTZWxlY3RvckFsbChmb2N1c2FibGVFbGVtZW50cy5qb2luKCcsJykpKTtcblx0fSxcblx0dHJhcFRhYihlKXtcblx0XHRsZXQgZm9jdXNlZEluZGV4ID0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xuXHRcdGlmKGUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSAwKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYoIWUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXHRrZXlMaXN0ZW5lcihlKXtcblx0XHRpZiAodGhpcy5pc09wZW4gJiYgZS5rZXlDb2RlID09PSAyNykge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHR9XG5cdFx0aWYgKHRoaXMuaXNPcGVuICYmIGUua2V5Q29kZSA9PT0gOSkge1xuXHRcdFx0dGhpcy50cmFwVGFiKGUpO1xuXHRcdH1cblx0fSxcblx0b3BlbigpIHtcblx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlMaXN0ZW5lci5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLmxhc3RGb2N1c2VkID0gIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4ge3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW5bMF0uZm9jdXMoKTt9LCAwKTtcblx0XHR0aGlzLnRvZ2dsZSgpO1xuXHR9LFxuXHRjbG9zZSgpe1xuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleUxpc3RlbmVyLmJpbmQodGhpcykpO1xuXHRcdHRoaXMubGFzdEZvY3VzZWQuZm9jdXMoKTtcblx0XHR0aGlzLnRvZ2dsZSgpO1xuXHR9LFxuXHR0b2dnbGUoKXtcblx0XHR0aGlzLmlzT3BlbiA9ICF0aGlzLmlzT3Blbjtcblx0XHR0aGlzLm5vZGUuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICF0aGlzLmlzT3Blbik7XG5cdFx0dGhpcy5ub2RlLmNsYXNzTGlzdC50b2dnbGUodGhpcy5zZXR0aW5ncy5vbkNsYXNzTmFtZSk7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLm1haW5TZWxlY3RvcikgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLm1haW5TZWxlY3Rvcikuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsIHRoaXMuaXNPcGVuKTtcblx0fSxcblx0Y2hhbmdlKCkge1xuXHRcdGlmKCF0aGlzLmlzT3Blbil7XG5cdFx0XHR0aGlzLm9wZW4oKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdH1cblx0XHR0eXBlb2YgdGhpcy5zZXR0aW5ncy5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyAmJiAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5jYWxsKHRoaXMpO1xuXHR9XG59O1xuXG5jb25zdCBpbml0ID0gKHNlbCwgb3B0cykgPT4ge1xuXHRsZXQgZWxzID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xuXHRcblx0aWYoZWxzLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCdNb2RhbCBjYW5ub3QgYmUgaW5pdGlhbGlzZWQsIG5vIHRyaWdnZXIgZWxlbWVudHMgZm91bmQnKTtcblx0XG5cdHJldHVybiBlbHMubWFwKGVsID0+IHtcblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKFN0b3JtTW9kYWwpLCB7XG5cdFx0XHRub2RlOiBlbCxcblx0XHRcdHNldHRpbmdzOiBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgb3B0cylcblx0XHR9KS5pbml0KCk7XG5cdH0pO1xufTtcbiAgICBcbmV4cG9ydCBkZWZhdWx0IHsgaW5pdCB9OyJdfQ==
